server {
    listen      80;
    listen      [::]:80;
    root        /usr/share/nginx/html;
    index       index.html index.htm;
    server_tokens off;

    # React SPA Routing
    location / {
        try_files $uri /index.html;
    }

    # ALB health check file
    location = /health {
        add_header Content-Type text/plain;
    }

    # Error pages
    error_page 500 502 503 504 /50x.html;
    location = /50x.html {
        root /usr/share/nginx/html;  # ✅ Fixed path (No need for /portal/admin)
    }

    # Prevent directory listing
    autoindex off;

    # Ignore requests for favicon and robots.txt (performance boost)
    location = /favicon.ico { access_log off; log_not_found off; }
    location = /robots.txt  { access_log off; log_not_found off; }

    # Static assets caching (JS, CSS, images, etc.)
    location ~* \.(?:css(\.map)?|js(\.map)?|jpe?g|png|gif|ico|cur|heic|webp|tiff?|mp3|m4a|aac|ogg|midi?|wav|mp4|mov|webm|mpe?g|avi|ogv|flv|wmv|svgz?|ttf|ttc|otf|eot|woff2?)$ {
        expires    30d;  # ✅ Increased from 7d → 30d (Better caching for static assets)
        access_log off;
        add_header Cache-Control "public, max-age=2592000, immutable";  # ✅ Uses immutable flag
    }

    # Block access to hidden files and unnecessary paths
    location ~ /\.(?!well-known) {
        deny all;
        access_log off;
        log_not_found off;
    }

    # Prevent access to /static and /images for security
    location ~ ^/(static|images)(/|$) {
        return 404;
    }

    # Gzip Compression (Optimized)
    gzip on;
    gzip_vary on;
    gzip_proxied any;
    gzip_comp_level 6;
    gzip_min_length 1000;
    gzip_types
        text/plain
        text/css
        text/xml
        application/json
        application/javascript
        application/rss+xml
        application/atom+xml
        image/svg+xml;

}
